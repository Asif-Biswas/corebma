{% extends 'main/base.html' %}
{% load static %}
{% block content %}
<!-- Page header start -->
<div class="page-header">
    
    <!-- Breadcrumb start -->
    <ol class="breadcrumb">
        <li class="breadcrumb-item">Conversation with 
			{% if conversation.user_one == request.user %}
				{{ conversation.user_two }}
			{% else %}
				{{ conversation.user_one }}
			{% endif %}
		</li>
    </ol>
    <!-- Breadcrumb end -->
</div>

<div class="container content">
	<div class="row">
		<div class="col-12">
			<div class="card">
				<div class="card-header">Chat</div>
				<div class="card-body height3">
					<ul class="chat-list hide-scrollbar" style="overflow-y: scroll; height: 55vh;">
						{% for message in conversation.messages.all %}
							{% if message.sender == request.user %}
								<li class="out">
									<div class="chat-img">
										<img alt="Avtar" src="{% static 'images/user.png' %}">
									</div>
									<div class="chat-body">
										<div class="chat-message">
											<h5>{{ message.text }}</h5>
											<p style="font-size: 10px; opacity: .8;">at {{ message.date|date:"d M Y H:i" }}</p>
										</div>
									</div>
								</li>
							{% else %}
								<li class="in">
									<div class="chat-img">
										<img alt="Avtar" src="{% static 'images/user.png' %}">
									</div>
									<div class="chat-body">
										<div class="chat-message">
											<h5>{{ message.text }}</h5>
											<p style="font-size: 10px; opacity: .8;">at {{ message.date|date:"d M Y H:i" }}</p>
										</div>
									</div>
								</li>
							{% endif %}
						{% endfor %}

						{% if not conversation.messages.all %}
							<p class="text-center mt-5">Send a message to start a conversation</p>
						{% endif %}
						
						{% comment %} <li class="out">
							<div class="chat-img">
								<img alt="Avtar" src="https://bootdey.com/img/Content/avatar/avatar6.png">
							</div>
							<div class="chat-body">
								<div class="chat-message">
									<h5>Serena</h5>
									<p>Next level veard</p>
								</div>
							</div>
						</li> {% endcomment %}
						
					</ul>
				</div>
				<form class="card-footer" action="{% url 'send_message' conversation.id %}" method="POST">
					{% csrf_token %}
					<div class="input-group">
						<input name="text" class="form-control" placeholder="Type your message here...">
						<span class="input-group-append">
							<button class="btn btn-primary" type="submit">Send</button>
						</span>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	const chatlist = document.querySelector('.chat-list');
	chatlist.scrollTop = chatlist.scrollHeight;
</script>

{% endblock %}